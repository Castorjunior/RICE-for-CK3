##############################################################################################
# 
# RICE Setup
# 
# These events set up various aspects of the mod at the start of the game.
# A lot of this is to maintain compatibility with other mods.
# 
##############################################################################################

namespace = RICEintro

# RICE debug testing event
RICEintro.9999 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				NOT = { has_global_variable = RICE_debug_testing_on }
			}
			set_global_variable = {
				name = RICE_debug_testing_on
				value = yes
			}
		}
		#if = {
		#	limit = {
		#		has_global_variable = RICE_debug_testing_on
		#	}
		#	remove_global_variable = RICE_debug_testing_on
		#}
	}
}


# Test 1
RICEintro.9998 = {
	hidden = yes
	
	#type = character_event
	#title = RICEintro.9998.t
	#desc = RICEintro.9998.desc
	#theme = RICE_theme_socotra_tree
	
	#trigger = {
	#	NOT = { has_game_rule = RICE_intro_event_off }
	#	#NOT = { has_global_variable = VIET_RICE_no_intro_popup }
	#}
	
	#option = { # Ok
	#	name = RICEintro.9999.a
	#}

	immediate = {
		every_courtier = {
			limit = {
				is_close_or_extended_family_of = no
			}
			death = {
				death_reason = death_disappearance
			}		
		}
		# South Arabian female
		create_character = {
			#location = root.location
			gender = female
			faith = root.faith
			culture = culture:south_arabian
			random_traits = yes
			employer = root
		}
		# South Arabian male
		create_character = {
			#location = root.location
			gender = male
			faith = root.faith
			culture = culture:south_arabian
			random_traits = yes
			employer = root
		}
		# Female - random
		create_character = {
			#location = root.location
			gender = female
			faith = root.faith
			random_culture = {
				culture:swahili = { weight = { base 10 } }
				culture:ethiopian = { weight = { base 10 } }
				culture:somali = { weight = { base 10 } }
				culture:gujarati = { weight = { base 10 } }
				culture:sindhi = { weight = { base 10 } }
				culture:kannada = { weight = { base 10 } }
				culture:persian = { weight = { base 10 } }
				culture:egyptian = { weight = { base 10 } }
				culture:yemeni = { weight = { base 10 } }
			}
			random_traits = yes
			employer = root
		}
		# South Arabian male
		create_character = {
			#location = root.location
			gender = male
			faith = root.faith
			culture = culture:south_arabian
			random_traits = yes
			employer = root
		}
		# Iranian male
		create_character = {
			#location = root.location
			gender = male
			faith = root.faith
			random_culture = {
				culture:persian = { weight = { base 10 } }
				culture:sogdian = { weight = { base 10 } }
				culture:khwarezmian = { weight = { base 10 } }
			}
			random_traits = yes
			employer = root
			after_creation = {
				# Set religion randomly - Zoroastrian, Buddhist, Muslim, Manichean, Nestorian, or Socotran ruler's religion (if it's something else)
				random_list = {
					10 = { }
					10 = { set_character_faith = faith:mahayana }
					10 = { set_character_faith = faith:nestorian }
					10 = { set_character_faith = faith:maturidi }
					10 = { set_character_faith = faith:mazdayasna }
					10 = { set_character_faith = faith:khurramism }
					10 = { set_character_faith = faith:manichean }
				}
			}
		}
		# Arabic male
		create_character = {
			#location = root.location
			gender = male
			faith = root.faith
			random_culture = {
				culture:yemeni = { weight = { base 10 } }
				culture:egyptian = { weight = { base 10 } }
				culture:levantine = { weight = { base 10 } }
				culture:bedouin = { weight = { base 10 } }
			}
			random_traits = yes
			employer = root
			after_creation = {
				# Set religion randomly - Zoroastrian, Buddhist, Muslim, Manichean, Nestorian, or Socotran ruler's religion (if it's something else)
				random_list = {
					10 = { }
					10 = { set_character_faith = faith:nestorian }
					10 = { set_character_faith = faith:ashari }
					10 = { set_character_faith = faith:ismaili }
					10 = { set_character_faith = faith:ibadi }
				}
			}
		}
		# Indian male
		create_character = {
			#location = root.location
			gender = male
			faith = root.faith
			random_culture = {
				culture:gujarati = { weight = { base 10 } }
				culture:sindhi = { weight = { base 10 } }
				culture:marathi = { weight = { base 10 } }
				culture:tamil = { weight = { base 10 } }
				culture:kannada = { weight = { base 10 } }
				culture:sinhala = { weight = { base 10 } }
			}
			random_traits = yes
			employer = root
			after_creation = {
				# Set religion randomly - Hindu, Buddhist, Nestorian, Muslim, or Socotran ruler's religion (if it's something else)
				random_list = {
					10 = { }
					25 = { set_character_faith = faith:vaishnavism }
					25 = { set_character_faith = faith:advaitism }
					25 = { set_character_faith = faith:shaivism }
					25 = { set_character_faith = faith:srikula_shaktism }
					25 = { set_character_faith = faith:kalikula_shaktism }
					25 = { set_character_faith = faith:smartism }
					25 = { set_character_faith = faith:krishnaism }
					10 = { set_character_faith = faith:theravada }
					10 = { set_character_faith = faith:vajrayana }
					10 = { set_character_faith = faith:mahayana }
					10 = { set_character_faith = faith:nestorian }
					10 = { set_character_faith = faith:ashari }
					10 = { set_character_faith = faith:maturidi }
				}
			}
		}
		# African male
		create_character = {
			#location = root.location
			gender = male
			faith = root.faith
			random_culture = {
				culture:ethiopian = { weight = { base 10 } }
				culture:nubian = { weight = { base 10 } }
				culture:somali = { weight = { base 10 } }
				culture:swahili = { weight = { base 10 } }
			}
			random_traits = yes
			employer = root
			after_creation = {
				# Set religion randomly - Hindu, Buddhist, Nestorian, Muslim, or Socotran ruler's religion (if it's something else)
				random_list = {
					10 = { }
					10 = { set_character_faith = faith:nestorian }
					10 = { set_character_faith = faith:coptic }
					10 = { set_character_faith = faith:ashari }
					10 = { set_character_faith = faith:waaqism_pagan }
				}
			}
		}	
	}
	
}

# Test 2
RICEintro.9997 = {
	type = character_event
	title = RICEintro.9997.t
	desc = RICEintro.9997.desc
	theme = RICE_theme_socotra_beach
	
	#trigger = {
	#	NOT = { has_game_rule = RICE_intro_event_off }
	#	#NOT = { has_global_variable = VIET_RICE_no_intro_popup }
	#}
	
	option = { # Ok
		name = RICEintro.9999.a
	}	
	
}

# Test 3
RICEintro.9996 = {
	type = character_event
	title = RICEintro.9996.t
	desc = RICEintro.9996.desc
	theme = RICE_theme_socotra_village
	
	#trigger = {
	#	NOT = { has_game_rule = RICE_intro_event_off }
	#	#NOT = { has_global_variable = VIET_RICE_no_intro_popup }
	#}
	
	option = { # Ok
		name = RICEintro.9999.a
	}	
	
}


# Hello event
RICEintro.0002 = {
	type = character_event
	title = RICEintro.0000.t
	desc = RICEintro.0000.desc
	theme = RICE_theme_kunlun_mountains
	
	trigger = {
		NOT = { has_game_rule = RICE_intro_event_off }
		#NOT = { has_global_variable = VIET_RICE_no_intro_popup }
	}
	
	option = { # Ok
		name = RICEintro.0000.a
	}	
	#option = { # Ok
	#	name = RICEintro.0000.b
	#	trigger_event = RICEintro.0010
	#}	
	#option = { # Ok
	#	name = RICEintro.0000.c
	#	set_global_variable = {
	#		name = VIET_RICE_no_intro_popup
	#		value = yes
	#	}
	#}	
	
}

# Event to set things up
RICEintro.0001 = {
	type = empty
	hidden = yes
	
	immediate = {
	
	
		############################################################
		#
		# GENERAL CULTURE CHANGES
		#
		############################################################

		culture:yemeni = { save_scope_as = yemeni }
		culture:somali = { save_scope_as = somali }
		culture:komi = { save_scope_as = komi }
		culture:evenk = {
			get_all_innovations_from = scope:komi
			add_innovation = innovation_RICE_taiga_survival
		}		
		culture:nivkh = {
			get_all_innovations_from = scope:komi
			add_innovation = innovation_RICE_taiga_survival
		}		
		culture:yakut = {
			get_all_innovations_from = scope:komi
			add_innovation = innovation_RICE_taiga_survival
		}		
		culture:yeniseian = {
			get_all_innovations_from = scope:komi
			add_innovation = innovation_RICE_taiga_survival
		}		
		culture:yukaghir = {
			get_all_innovations_from = scope:komi
			add_innovation = innovation_RICE_taiga_survival
		}		
		culture:south_arabian = {
			get_all_innovations_from = scope:yemeni
		}		
		culture:swahili = {
			get_all_innovations_from = scope:somali
			add_innovation = innovation_RICE_swahili_colonies
		}			
		culture:malagasy = {
			get_all_innovations_from = scope:somali
			add_innovation = innovation_RICE_swahili_colonies
		}			
		culture:shona = {
			get_all_innovations_from = scope:somali
			add_innovation = innovation_RICE_swahili_colonies
		}		
		title:c_socotra = {
			set_county_culture = culture:south_arabian
		}		
		title:c_al-asa = {
			set_county_culture = culture:south_arabian
		}		
		title:c_dhofar = {
			set_county_culture = culture:south_arabian
		}		
		title:c_mahra = {
			set_county_culture = culture:south_arabian
		}		
		title:c_duqm = {
			set_county_culture = culture:south_arabian
		}
		if = {
			limit = {
				title:c_socotra.holder = {
					#highest_held_title_tier = tier_county
					has_culture_group = culture_group:arabic_group
				}
			}
			title:c_socotra.holder = {
				make_south_arabian_culture_effect = yes
			}
		}	
		if = {
			limit = {
				title:c_al-asa.holder = {
					highest_held_title_tier = tier_county
					has_culture_group = culture_group:arabic_group
				}
			}
			title:c_al-asa.holder = {
				make_south_arabian_culture_effect = yes
			}
		}	
		if = {
			limit = {
				title:c_dhofar.holder = {
					highest_held_title_tier = tier_county
					has_culture_group = culture_group:arabic_group
				}
			}
			title:c_dhofar.holder = {
				make_south_arabian_culture_effect = yes
			}
		}	
		if = {
			limit = {
				title:c_mahra.holder = {
					highest_held_title_tier = tier_county
					has_culture_group = culture_group:arabic_group
				}
			}
			title:c_mahra.holder = {
				make_south_arabian_culture_effect = yes
			}
		}	
		#if = {
		#	limit = {
		#		title:c_duqm.holder = {
		#			highest_held_title_tier = tier_county
		#			has_culture_group = culture_group:arabic_group
		#		}
		#	}
		#	title:c_duqm.holder = {
		#		make_south_arabian_culture_effect = yes
		#	}
		#}
		
		
		############################################################
		#
		# BUILDINGS
		#
		############################################################	


		## Add Chios buildings
		title:b_chios.title_province = {
			add_special_building = RICE_mastic_industry_01
		}
	
		## Add Siwa Oasis buildings
		title:b_siwa.title_province = {
			add_special_building_slot = RICE_siwa_oracle_of_amun
		}
		title:b_kharga.title_province = {
			add_special_building_slot = RICE_kharga_temple_of_hibis
		}
		
		## Add Bawarij Base
		title:b_suq-socotra.title_province = {
			add_special_building = RICE_bawarij_den_01
		}
		
		## Add Indian Ocean Pirate Bases
		title:b_huzu.title_province = { # Kish Island
			add_special_building = RICE_pirate_den_01
		}
		title:b_dahlak_kebir.title_province = { # Dahlak
			add_special_building = RICE_pirate_den_01
		}
		title:b_debul.title_province = { # Sindh
			add_special_building = RICE_pirate_den_01
		}
		title:b_mahoyadapuram.title_province = { # Kerala
			add_special_building = RICE_pirate_den_01
		}
		title:b_uwal.title_province = { # Bahrain
			add_special_building = RICE_pirate_den_01
		}

		
		
		############################################################
		#
		# MISC
		#
		############################################################		
	
		title:c_nantes = { # Make a building later or not? It's not a major industry and wasn't made into a state monopoly until the 1300s/1400s
			add_county_modifier = {
				modifier = RICE_breton_guerande_salterns
			}
		}
	
		#title:c_chios = {
		#	add_county_modifier = {
		#		modifier = RICE_chios_mastic_groves
		#	}
		#}
		
		title:c_fuqi = {
			add_county_modifier = {
				modifier = RICE_tuyuhun_qinghaicong_horses
			}
		}	
		title:c_gerqen = {
			add_county_modifier = {
				modifier = RICE_tuyuhun_qinghaicong_horses
			}
		}			
		title:c_fuqi.holder = {
			add_character_modifier = {
				modifier = RICE_tuyuhun_character_owns_qinghaicong_horses
			}
		}	
		title:c_gerqen.holder = {
			add_character_modifier = {
				modifier = RICE_tuyuhun_character_owns_qinghaicong_horses
			}
		}	

		
		title:c_siwa = {
			set_county_faith = faith:coptic
			set_county_culture = culture:butr
			add_county_modifier = {
				modifier = RICE_siwa_oasis_defense
			}
		}
		
		title:c_socotra.holder = {
			trigger_event = socotra.0001
			#make_socotra_diverse_effect = yes
		}
		
		if = {
			limit = {
				title:c_siwa.holder = {
					highest_held_title_tier = tier_county
				}
			}
			title:c_siwa.holder = { 
				make_siwi_culture_effect = yes
			}
		}
		
		if = {
			limit = {
				current_date < 900.1.1
			}
			character:247407 = { # Give claim to Murong Fu, last known claimant of the Tuyuhun Kingdom
				add_pressed_claim = title:d_tuyuhun
				#add_pressed_claim = title:k_tuyuhun_restored
			}
		}
	

		
		every_player = {
			if = {
				limit = {
					is_ai = no
				}
				trigger_event = RICEintro.0002
			}
		}
		
		if = {
			limit = {
				any_ruler = {
					is_ai = yes
					any_directly_owned_province = {
						RICE_is_in_siberian_region_courtier_spawn_trigger = yes
					}
					NOT = {
						any_courtier = {
							RICE_siberia_siberian_wanderer_trigger = yes
						}		
					}
				}
			}
			random_ruler = {
				limit = {
					is_ai = yes
					any_directly_owned_province = {
						RICE_is_in_siberian_region_courtier_spawn_trigger = yes
					}
					NOT = {
						any_courtier = {
							RICE_siberia_siberian_wanderer_trigger = yes
						}		
					}
				}
				trigger_event = siberia.0001
			}
			random_ruler = {
				limit = {
					is_ai = yes
					any_directly_owned_province = {
						RICE_is_in_siberian_region_courtier_spawn_trigger = yes
					}
					NOT = {
						any_courtier = {
							RICE_siberia_siberian_wanderer_trigger = yes
						}		
					}
				}
				trigger_event = siberia.0001
			}
			random_ruler = {
				limit = {
					is_ai = yes
					any_directly_owned_province = {
						RICE_is_in_siberian_region_courtier_spawn_trigger = yes
					}
					NOT = {
						any_courtier = {
							RICE_siberia_siberian_wanderer_trigger = yes
						}		
					}
				}
				trigger_event = siberia.0001
			}
			random_ruler = {
				limit = {
					is_ai = yes
					any_directly_owned_province = {
						RICE_is_in_siberian_region_courtier_spawn_trigger = yes
					}
					NOT = {
						any_courtier = {
							RICE_siberia_siberian_wanderer_trigger = yes
						}		
					}
				}
				trigger_event = siberia.0001
			}
			random_ruler = {
				limit = {
					is_ai = yes
					any_directly_owned_province = {
						RICE_is_in_siberian_region_courtier_spawn_trigger = yes
					}
					NOT = {
						any_courtier = {
							RICE_siberia_siberian_wanderer_trigger = yes
						}		
					}
				}
				trigger_event = siberia.0001
			}
		}		
	}
}

###############################################################
# 
# MISC GAME START EVENTS
# 
###############################################################





